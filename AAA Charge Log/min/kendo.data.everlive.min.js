(function(b,a){if(typeof define==="function"&&define.amd){define(["Everlive"],function(c){a(c)})}else{a(b.Everlive)}}(this,function(d){var a=window.jQuery,j=window.kendo;if(a===undefined||j===undefined){return}var e=a.extend;e(true,j.data,{schemas:{everlive:{type:"json",data:function(o){if(typeof o.ModifiedAt!=="undefined"){return{ModifiedAt:o.ModifiedAt}}else{return o.Result||o}},total:"Count",model:{id:"Id"}}},transports:{everlive:{read:{dataType:"json",type:"GET",cache:false},update:{dataType:"json",contentType:"application/json",type:"PUT",cache:false},create:{dataType:"json",contentType:"application/json",type:"POST",cache:false},destroy:{dataType:"json",type:"DELETE",cache:false},parameterMap:function(o,p){if(p==="destroy"){return{}}if(p==="create"||p==="update"){return JSON.stringify(o)}if(p==="read"){return null}}}}});function n(o){var q={};if(o){if(o.skip){q.$skip=o.skip;delete o.skip}if(o.take){q.$take=o.take;delete o.take}if(o.sort){var s=o.sort;var r={};if(!a.isArray(s)){s=[s]}a.each(s,function(t,u){r[u.field]=u.dir==="asc"?1:-1});q.$sort=r;delete o.sort}if(o.filter){var p=new f().build(o.filter);q.$where=p;delete o.filter}}return q}var l=["startsWith","endsWith","contains"];function f(){}f.prototype={build:function(o){return this._build(o)},_build:function(o){if(this._isRaw(o)){return this._raw(o)}else{if(this._isSimple(o)){return this._simple(o)}else{if(this._isRegex(o)){return this._regex(o)}else{if(this._isAnd(o)){return this._and(o)}else{if(this._isOr(o)){return this._or(o)}}}}}},_isRaw:function(o){return o.operator==="_raw"},_raw:function(p){var o={};o[p.field]=p.value;return o},_isSimple:function(o){return typeof o.logic==="undefined"&&!this._isRegex(o)},_simple:function(p){var r={},o={};var q=this._translateoperator(p.operator);if(q){r[q]=p.value}else{r=p.value}o[p.field]=r;return o},_isRegex:function(o){return a.inArray(o.operator,l)!==-1},_regex:function(p){var o={};var q=this._getRegex(p);var r=this._getRegexValue(q);o[p.field]=r;return o},_getRegex:function(o){var p=o.value;switch(o.operator){case"contains":return new RegExp(".*"+p+".*","i");case"startsWith":return new RegExp(p+".*","i");case"endsWith":return new RegExp(".*"+p,"i")}throw new Error("Unknown operator type.")},_getRegexValue:function(o){return d.QueryBuilder.prototype._getRegexValue.call(this,o)},_isAnd:function(o){return o.logic==="and"},_and:function(o){var p,q,t,s={};var r=o.filters;for(p=0,q=r.length;p<q;p++){t=this._build(r[p]);s=this._andAppend(s,t)}return s},_andAppend:function(o,p){return d.QueryBuilder.prototype._andAppend.call(this,o,p)},_isOr:function(o){return o.logic==="or"},_or:function(o){var p,q,t,s=[];var r=o.filters;for(p=0,q=r.length;p<q;p++){t=this._build(r[p]);s.push(t)}return{$or:s}},_translateoperator:function(o){switch(o){case"eq":return null;case"neq":return"$ne";case"gt":return"$gt";case"lt":return"$lt";case"gte":return"$gte";case"lte":return"$lte"}throw new Error("Unknown operator type.")}};function b(o){return new d.Query(o.$where,null,o.$sort,o.$skip,o.$take)}var m=j.data.RemoteTransport.prototype.setup;j.data.RemoteTransport.prototype.setup=function(p,s){if(!p.url&&!this.options[s].url&&this.options.typeName){if(!d.$){throw new Error("You should either specify a url for this transport method, or instantiate an Everlive instance.")}p.url=d.Request.prototype.buildUrl(d.$.setup)+this.options.typeName;if(s==="update"||s==="destroy"){p.url+="/"+p.data[d.idField]}}if(d.$){p.headers=d.Request.prototype.buildAuthHeader(d.$.setup)}if(s==="read"&&p.data){var q=n(p.data);var o=b(q);p.headers=a.extend(p.headers,d.Request.prototype.buildQueryHeaders(o))}if(s==="create"||s==="read"||s==="update"){var r=p.success;p.success=function(t){d._traverseAndRevive(t);if(r){r(t)}}}return m.call(this,p,s)};var c=[d.idField,"CreatedAt"];var k=j.data.Model.prototype.accept;j.data.Model.prototype.accept=function(o){var q=this,p,r;d._traverseAndRevive(o);if(o&&q.isNew()&&o[d.idField]){for(p in q.fields){if(a.inArray(p,c)===-1){r=q.get(p);o[p]=r}}}else{if(o&&typeof o.ModifiedAt!=="undefined"){for(p in q.fields){if(p!=="ModifiedAt"){r=q.get(p);o[p]=r}}}}k.call(this,o)};var i=function(o,p){var q=h(p[p.length-1]);var s=p.slice(0,p.length-1);var t="/_expand";for(var r=0;r<s.length;r++){t+="/"+h(s[r])}return(function(v,u){return function(w){var x=o+"";if(w.Id&&u){x+=v+"/"+w.Id+"/"+u}return x}}(t,q))};var g=function(o){if(typeof o==="string"){return{}}else{return{"X-Everlive-Filter":JSON.stringify(o.filter),"X-Everlive-Sort":JSON.stringify(o.sort),"X-Everlive-Single-Field":o.singleField,"X-Everlive-Skip":o.skip,"X-Everlive-Take":o.take,"X-Everlive-Fields":JSON.stringify(o.fields),}}};var h=function(o){if(typeof o==="string"){return o}else{if(o.relation){return o.relation}else{throw new Error("You need to specify a 'relation' for an expand node when using the object notation")}}};d.createHierarchicalDataSource=function(t){t=t||{};var q=t.expand;var u=t.typeName;delete t.expand;delete t.typeName;var o;if(t.url){o=t.url}else{if(d.$&&u){o=d.Request.prototype.buildUrl(d.$.setup)+u}else{if(!d.$){throw new Error("You need to instantiate an Everlive instance in order to create a kendo HierarchicalDataSource.")}if(!u){throw new Error("You need to specify a 'typeName' in order to create a kendo HierarchicalDataSource.")}}}var r;if(q){for(var s=q.length-1;s>=0;s--){var r={model:{hasChildren:h(q[s]),children:{type:"everlive",transport:{read:{url:i(o,q.slice(0,s+1)),headers:g(q[s])}},schema:r}}}}}var p={};p.type="everlive";p.transport={typeName:u},p.schema=r;e(true,p,t);return new j.data.HierarchicalDataSource(p)};d.createDataSource=function(p){p=p||{};var q=p.typeName;if(!q){throw new Error("You need to specify a 'typeName' in order to create a kendo DataSource.")}delete p.typeName;var o={};o.type="everlive";o.transport={typeName:q},e(true,o,p);return new j.data.DataSource(o)}}));