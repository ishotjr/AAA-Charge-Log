/*!
The MIT License (MIT)

Copyright (c) 2013 Telerik AD

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.y distributed under the MIT license.
*/
/*
 Everlive SDK
Version 1.2.0
 */
(function(b,a){if(typeof define==="function"&&define.amd){define(["underscore","rsvp","reqwest","jstz"],function(c,f,e,d){return(b.Everlive=a(c,f,e,d))})}else{if(typeof exports==="object"){module.exports=a(require("underscore"),require("rsvp"))}else{b.Everlive=a(b._,b.RSVP,b.reqwest,b.jstz)}}}(this,function(a,z,y,q){var B=Array.prototype.slice;var j="//api.everlive.com/v1/";var n="Id";function m(E,D,C){if(!C){C="The "+D+" is required"}if(typeof E==="undefined"||E===null){throw new Error(C)}}function A(C){this.url=j;this.apiKey=null;this.masterKey=null;this.token=null;this.tokenType=null;this.scheme="http";if(typeof C==="string"){this.apiKey=C}else{a.extend(this,C)}}var p=[];function i(C){var D=this;this.setup=new A(C);a.each(p,function(E){E.func.call(D,C)});if(i.$===null){i.$=D}}i.$=null;i.idField=n;i.initializations=p;i.init=function(C){i.$=null;return new i(C)};i.buildUrl=function(C){var D="";if(typeof C.scheme==="string"){D+=C.scheme+":"}D+=C.url;if(C.apiKey){D+=C.apiKey+"/"}return D};i.prototype.data=function(C){return new h(this.setup,C)};i.prototype.buildUrl=function(){return i.buildUrl(this.setup)};var e=function(E,D){var C=null;if(D&&D.authHeaders===false){return C}if(E.token){C=(E.tokenType||"bearer")+" "+E.token}else{if(E.masterKey){C="masterkey "+E.masterKey}}if(C){return{Authorization:C}}else{return null}};i.prototype.buildAuthHeader=function(){return e(this.setup)};(function(){var E={query:1,where:100,filter:101,and:110,or:111,not:112,equal:120,not_equal:121,lt:122,lte:123,gt:124,gte:125,isin:126,notin:127,all:128,size:129,regex:130,contains:131,startsWith:132,endsWith:133,nearShpere:140,withinBox:141,withinPolygon:142,withinShpere:143,select:200,exclude:201,order:300,order_desc:301,skip:400,take:401,expand:402};function C(K,J){this.operator=K;this.operands=J||[]}C.prototype={addOperand:function(J){this.operands.push(J)}};function F(L,K,N,M,O,J){this.filter=L;this.fields=K;this.sort=N;this.toskip=M;this.totake=O;this.expandExpression=J;this.expr=new C(E.query)}F.prototype={where:function(J){if(J){return this._simple(E.filter,[J])}else{return new I(this)}},select:function(){return this._simple(E.select,arguments)},order:function(J){return this._simple(E.order,[J])},orderDesc:function(J){return this._simple(E.order_desc,[J])},skip:function(J){return this._simple(E.skip,[J])},take:function(J){return this._simple(E.take,[J])},expand:function(J){return this._simple(E.expand,[J])},build:function(){return new G(this).build()},_simple:function(K,L){var J=B.call(L);this.expr.addOperand(new C(K,J));return this}};function I(K,J,L){this.parent=K;this.single=L;this.expr=new C(J||E.where);this.parent.expr.addOperand(this.expr)}I.prototype={and:function(){return new I(this,E.and)},or:function(){return new I(this,E.or)},not:function(){return new I(this,E.not,true)},_simple:function(K){var J=B.call(arguments,1);this.expr.addOperand(new C(K,J));return this._done()},eq:function(J,K){return this._simple(E.equal,J,K)},ne:function(J,K){return this._simple(E.not_equal,J,K)},gt:function(J,K){return this._simple(E.gt,J,K)},gte:function(J,K){return this._simple(E.gte,J,K)},lt:function(J,K){return this._simple(E.lt,J,K)},lte:function(J,K){return this._simple(E.lte,J,K)},isin:function(J,K){return this._simple(E.isin,J,K)},notin:function(J,K){return this._simple(E.notin,J,K)},all:function(J,K){return this._simple(E.all,J,K)},size:function(J,K){return this._simple(E.size,J,K)},regex:function(J,L,K){return this._simple(E.regex,J,L,K)},startsWith:function(J,L,K){return this._simple(E.startsWith,J,L,K)},endsWith:function(J,L,K){return this._simple(E.endsWith,J,L,K)},nearSphere:function(K,M,J,L){return this._simple(E.nearShpere,K,M,J,L)},withinBox:function(J,K,L){return this._simple(E.withinBox,J,K,L)},withinPolygon:function(J,K){return this._simple(E.withinPolygon,J,K)},withinCenterSphere:function(K,J,M,L){return this._simple(E.withinShpere,K,J,M,L)},done:function(){if(this.parent instanceof I){return this.parent._done()}else{return this.parent}},_done:function(){if(this.single){return this.parent}else{return this}}};I.prototype.equal=I.prototype.eq;I.prototype.notEqual=I.prototype.ne;I.prototype.greaterThan=I.prototype.gt;I.prototype.greaterThanEqual=I.prototype.gte;I.prototype.lessThan=I.prototype.lt;I.prototype.lessThanEqual=I.prototype.lte;function G(J){this.query=J;this.expr=J.expr}var D={radians:"$maxDistance",km:"$maxDistanceInKilometers",miles:"$maxDistanceInMiles"};var H={radians:"radius",km:"radiusInKilometers",miles:"radiusInMiles"};G.prototype={build:function(){var J=this.query;if(J.filter||J.fields||J.sort||J.toskip||J.totake||J.expandExpression){return{$where:J.filter||null,$select:J.fields||null,$sort:J.sort||null,$skip:J.toskip||null,$take:J.totake||null,$expand:J.expandExpression||null}}return{$where:this._buildWhere(),$select:this._buildSelect(),$sort:this._buildSort(),$skip:this._getSkip(),$take:this._getTake(),$expand:this._getExpand()}},_getSkip:function(){var J=a.find(this.expr.operands,function(M,K,L){return M.operator===E.skip});return J?J.operands[0]:null},_getTake:function(){var J=a.find(this.expr.operands,function(M,K,L){return M.operator===E.take});return J?J.operands[0]:null},_getExpand:function(){var J=a.find(this.expr.operands,function(M,K,L){return M.operator===E.expand});return J?J.operands[0]:null},_buildSelect:function(){var K=a.find(this.expr.operands,function(N,L,M){return N.operator===E.select});var J={};if(K){a.reduce(K.operands,function(L,M){L[M]=1;return L},J);return J}else{return null}},_buildSort:function(){var K=a.filter(this.expr.operands,function(N,L,M){return N.operator===E.order||N.operator===E.order_desc});var J={};if(K.length>0){a.reduce(K,function(L,M){L[M.operands[0]]=M.operator===E.order?1:-1;return L},J);return J}else{return null}},_buildWhere:function(){var K=a.find(this.expr.operands,function(N,L,M){return N.operator===E.where});if(K){return this._build(new C(E.and,K.operands))}else{var J=a.find(this.expr.operands,function(N,L,M){return N.operator===E.filter});if(J){return J.operands[0]}return null}},_build:function(J){if(this._isSimple(J)){return this._simple(J)}else{if(this._isRegex(J)){return this._regex(J)}else{if(this._isGeo(J)){return this._geo(J)}else{if(this._isAnd(J)){return this._and(J)}else{if(this._isOr(J)){return this._or(J)}else{if(this._isNot(J)){return this._not(J)}}}}}}},_isSimple:function(J){return J.operator>=E.equal&&J.operator<=E.size},_simple:function(J){var N={},K={};var L=J.operands;var M=this._translateoperator(J.operator);if(M){N[M]=L[1]}else{N=L[1]}K[L[0]]=N;return K},_isRegex:function(J){return J.operator>=E.regex&&J.operator<=E.endsWith},_regex:function(J){var K={};var M=this._getRegex(J);var N=this._getRegexValue(M);var L=J.operands;K[L[0]]=N;return K},_getRegex:function(J){var L=J.operands[1];var K=J.operands[2]?J.operands[2]:"";switch(J.operator){case E.regex:return L instanceof RegExp?L:new RegExp(L,K);case E.startsWith:return new RegExp(L+".*",K);case E.endsWith:return new RegExp(".*"+L,K);default:throw new Error("Unknown operator type.")}},_getRegexValue:function(K){var J="";if(K.global){J+="g"}if(K.multiline){J+="m"}if(K.ignoreCase){J+="i"}return{$regex:K.source,$options:J}},_isGeo:function(J){return J.operator>=E.nearShpere&&J.operator<=E.withinShpere},_geo:function(J){var K={};var L=J.operands;K[L[0]]=this._getGeoTerm(J);return K},_getGeoTerm:function(J){switch(J.operator){case E.nearShpere:return this._getNearSphereTerm(J);case E.withinBox:return this._getWithinBox(J);case E.withinPolygon:return this._getWithinPolygon(J);case E.withinShpere:return this._getWithinCenterSphere(J);default:throw new Error("Unknown operator type.")}},_getNearSphereTerm:function(K){var O=K.operands;var J=this._getGeoPoint(O[1]);var L=O[2];var N=O[3];var M;var P={"$nearSphere":J};if(typeof L!=="undefined"){M=D[N]||D.radians;P[M]=L}return P},_getWithinBox:function(K){var L=K.operands;var J=this._getGeoPoint(L[1]);var M=this._getGeoPoint(L[2]);return{"$within":{"$box":[J,M]}}},_getWithinPolygon:function(J){var K=J.operands;var L=this._getGeoPoints(K[1]);return{"$within":{"$polygon":L}}},_getWithinCenterSphere:function(K){var M=K.operands;var J=this._getGeoPoint(M[1]);var N=M[2];var L=M[3];var O=H[L]||H.radians;var P={center:J};P[O]=N;return{"$within":{"$centerSphere":P}}},_getGeoPoint:function(J){if(a.isArray(J)){return new k(J[0],J[1])}return J},_getGeoPoints:function(J){var K=this;return a.map(J,function(L){return K._getGeoPoint(L)})},_isAnd:function(J){return J.operator===E.and},_and:function(J){var K,L,O,N={};var M=J.operands;for(K=0,L=M.length;K<L;K++){O=this._build(M[K]);N=this._andAppend(N,O)}return N},_andAppend:function(J,O){var K,N,L,Q,P;var M=a.keys(O);for(K=0,N=M.length;K<N;K++){L=M[K];Q=J[L];if(typeof Q==="undefined"){J[L]=O[L]}else{P=O[L];if(typeof Q==="object"&&typeof P==="object"){Q=a.extend(Q,P)}else{Q=P}J[L]=Q}}return J},_isOr:function(J){return J.operator===E.or},_or:function(J){var K,L,O,N=[];var M=J.operands;for(K=0,L=M.length;K<L;K++){O=this._build(M[K]);N.push(O)}return{$or:N}},_isNot:function(J){return J.operator===E.not},_not:function(J){return{$not:this._build(J.operands[0])}},_translateoperator:function(J){switch(J){case E.equal:return null;case E.not_equal:return"$ne";case E.gt:return"$gt";case E.lt:return"$lt";case E.gte:return"$gte";case E.lte:return"$lte";case E.isin:return"$in";case E.notin:return"$nin";case E.all:return"$all";case E.size:return"$size"}throw new Error("Unknown operator type.")}};i.Query=F;i.QueryBuilder=G}());var x=(function(){var E={filter:"X-Everlive-Filter",select:"X-Everlive-Fields",sort:"X-Everlive-Sort",skip:"X-Everlive-Skip",take:"X-Everlive-Take",expand:"X-Everlive-Expand"};function L(P,O){m(P,"setup");m(O,"options");this.setup=P;this.method=null;this.endpoint=null;this.data=null;this.headers={};this.success=null;this.error=null;this.parse=L.parsers.simple;a.extend(this,O);this._init(O)}L.prototype={send:function(){i.sendRequest(this)},buildAuthHeader:e,buildUrl:function D(O){return i.buildUrl(O)},buildQueryHeaders:function C(O){if(O){if(O instanceof i.Query){return L.prototype._buildQueryHeaders(O)}else{return L.prototype._buildFilterHeader(O)}}else{return{}}},_init:function(O){a.extend(this.headers,this.buildAuthHeader(this.setup,O),this.buildQueryHeaders(O.filter),O.headers)},_buildQueryHeaders:function(P){P=P.build();var O={};if(P.$where!==null){O[E.filter]=JSON.stringify(P.$where)}if(P.$select!==null){O[E.select]=JSON.stringify(P.$select)}if(P.$sort!==null){O[E.sort]=JSON.stringify(P.$sort)}if(P.$skip!==null){O[E.skip]=P.$skip}if(P.$take!==null){O[E.take]=P.$take}if(P.$expand!==null){O[E.expand]=JSON.stringify(P.$expand)}return O},_buildFilterHeader:function(O){var P={};P[E.filter]=JSON.stringify(O);return P}};i.Request=L;i.prototype.request=function(O){return new L(this.setup,O)};function H(U){var R;if(R=U.match(/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?))$/)){var T=R[12];if(T){if(T.length>3){T=Math.round(Number(T.substr(0,3)+"."+T.substr(3)))}else{if(T.length<3){T+=T.length===2?"0":"00"}}}var O=new Date(Date.UTC(Number(R[1]),(Number(R[3])-1)||0,Number(R[5])||0,Number(R[7])||0,Number(R[8])||0,Number(R[10])||0,Number(T)||0));if(R[13]&&R[13]!=="Z"){var P=Number(R[16])||0,Q=Number(R[17])||0;P*=3600000;Q*=60000;var S=P+Q;if(R[15]==="+"){S=-S}O=new Date(O.valueOf()+S)}return O}else{return null}}function F(P,Q){if(typeof Q==="string"){var O=H(Q);if(O){Q=O}}return Q}function M(R,O){var P,S,Q;for(P in R){if(R.hasOwnProperty(P)){S=R[P];Q=O(P,S);R[P]=Q;if(S===Q&&typeof S==="object"){M(S,O)}}}}function N(O){M(O,F)}i._traverseAndRevive=N;function I(O){if(typeof O==="string"&&O.length>0){O=JSON.parse(O,F)}else{if(typeof O==="object"){N(O)}}if(O){return{result:O.Result,count:O.Count}}else{return O}}function G(P){if(typeof P==="string"&&P.length>0){try{P=JSON.parse(P);return{message:P.message,code:P.errorCode}}catch(O){return P}}else{return P}}function J(O){if(typeof O==="string"&&O.length>0){O=JSON.parse(O,F)}else{if(typeof O==="object"){N(O)}}if(O){return{result:O.Result}}else{return O}}function K(O){if(typeof O==="string"&&O.length>0){O=JSON.parse(O,F)}else{if(typeof O==="object"){N(O)}}if(O){return{result:O.Result,ModifiedAt:O.ModifiedAt}}else{return O}}L.parsers={simple:{result:I,error:G},single:{result:J,error:G},update:{result:K,error:G}};i.disableRequestCache=function(R,O){if(O==="GET"){var Q=(new Date()).getTime();var P=R.indexOf("?")>-1?"&":"?";R+=P+"_el="+Q}return R};if(typeof i.sendRequest==="undefined"){i.sendRequest=function(P){var Q=P.buildUrl(P.setup)+P.endpoint;Q=i.disableRequestCache(Q,P.method);var O=P.method==="GET"?P.data:JSON.stringify(P.data);y({url:Q,method:P.method,data:O,headers:P.headers,type:"json",contentType:"application/json",crossOrigin:true,success:function(R,T,S){P.success.call(P,P.parse.result(R))},error:function(S,T,R){P.error.call(P,P.parse.error(S.responseText))}})}}return L}());i.getCallbacks=function(E,C){var D;if(typeof E!=="function"&&typeof C!=="function"){D=new z.Promise(function(G,F){E=function(H){G(H)};C=function(H){F(H)}})}return{promise:D,success:E,error:C}};function f(E,F,D){var C=i.getCallbacks(F,D);E(C.success,C.error);return C.promise}function r(C,D){return function(F,G){var E=F.result;if(a.isArray(C)||typeof C.length==="number"){a.each(C,function(I,H){a.extend(I,E[H])})}else{a.extend(C,E)}D(F,G)}}function s(C,D){return function(F){var E=F.ModifiedAt;C.ModifiedAt=E;D(F)}}function h(D,C){this.setup=D;this.collectionName=C;this.options=null}h.prototype={withHeaders:function(C){var D=this.options||{};D.headers=a.extend(D.headers||{},C);this.options=D;return this},expand:function(C){var D={"X-Everlive-Expand":JSON.stringify(C)};return this.withHeaders(D)},_createRequest:function(C){a.extend(C,this.options);this.options=null;return new x(this.setup,C)},get:function(D,F,C){var E=this;return f(function(I,G){var H=E._createRequest({method:"GET",endpoint:E.collectionName,filter:D,success:I,error:G});H.send()},F,C)},getById:function(D,F,C){var E=this;return f(function(I,G){var H=E._createRequest({method:"GET",endpoint:E.collectionName+"/"+D,parse:x.parsers.single,success:I,error:G});H.send()},F,C)},count:function(D,F,C){var E=this;return f(function(I,G){var H=E._createRequest({method:"GET",endpoint:E.collectionName+"/_count",filter:D,parse:x.parsers.single,success:I,error:G});H.send()},F,C)},create:function(C,F,D){var E=this;return f(function(I,G){var H=E._createRequest({method:"POST",endpoint:E.collectionName,data:C,parse:x.parsers.single,success:r(C,I),error:G});H.send()},F,D)},rawUpdate:function(C,E,G,D){var F=this;return f(function(L,I){var H=F.collectionName;var J=null;if(typeof E==="string"){H+="/"+E}else{if(typeof E==="object"){J=E}}var K=F._createRequest({method:"PUT",endpoint:H,data:C,filter:J,success:L,error:I});K.send()},G,D)},_update:function(C,E,H,F,I,D){var G=this;return f(function(O,L){var K=G.collectionName;var N=O;if(H){K+="/"+C[n];N=s(C,O)}var J={};J[F?"$replace":"$set"]=C;var M=G._createRequest({method:"PUT",endpoint:K,parse:x.parsers.update,data:J,filter:E,success:N,error:L});M.send()},I,D)},updateSingle:function(D,E,C){return this._update(D,null,true,false,E,C)},update:function(E,D,F,C){return this._update(E,D,false,false,F,C)},_destroy:function(C,E,G,H,D){var F=this;return f(function(L,J){var I=F.collectionName;if(G){I+="/"+C[n]}var K=F._createRequest({method:"DELETE",endpoint:I,filter:E,success:L,error:J});K.send()},H,D)},destroySingle:function(D,E,C){return this._destroy(D,null,true,E,C)},destroy:function(D,E,C){return this._destroy(null,D,false,E,C)},setAcl:function(C,E,G,D){var F=this;return f(function(M,J){var I=F.collectionName;if(typeof E==="string"){I+="/"+E}else{if(typeof E==="object"){I+="/"+E[n]}}I+="/_acl";var K,H;if(C===null){K="DELETE"}else{K="PUT";H=C}var L=F._createRequest({method:K,endpoint:I,data:H,success:M,error:J});L.send()},G,D)},setOwner:function(E,D,G,C){var F=this;return f(function(K,I){var H=F.collectionName;if(typeof D==="string"){H+="/"+D}else{if(typeof D==="object"){H+="/"+D[n]}}H+="/_owner";var J=F._createRequest({method:"PUT",endpoint:H,data:{Owner:E},success:K,error:I});J.send()},G,C)},save:function(E,G,C){var F=this;var D=this.isNew(E);return f(function(K,H){function J(L){L.type=D?"create":"update";K(L)}function I(L){L.type=D?"create":"update";H(L)}if(D){return F.create(E,J,I)}else{return F.updateSingle(E,J,I)}},G,C)},isNew:function(C){return typeof C[n]==="undefined"}};i.Data=h;function k(D,C){this.longitude=D||0;this.latitude=C||0}i.GeoPoint=k;var d={unauthenticated:"unauthenticated",masterKey:"masterKey",invalidAuthentication:"invalidAuthentication",authenticated:"authenticated"};i.AuthStatus=d;function l(G,E,H,C){if(G.masterKey){return f(function(J,I){J({status:d.masterKey})},H,C)}if(!G.token){return f(function(J,I){J({status:d.unauthenticated})},H,C)}var D;if(H){D=function(I){if(I&&I.code===601){H({status:d.invalidAuthentication})}else{C(I)}}}var F=E(H,D);if(F){F=F.then(function(I){return{status:d.authenticated,user:I.result}},function(I){if(I&&I.code===601){return{status:d.invalidAuthentication}}else{throw I}})}return F}i.prototype.authInfo=function(D,C){return l(this.setup,a.bind(this.Users.getById,this.Users,"me"),D,C)};var c=function(C){C._loginSuccess=function(D){var E=D.result;var F=this.setup;F.token=E.access_token;F.tokenType=E.token_type};C._logoutSuccess=function(){var D=this.setup;D.token=null;D.tokenType=null};C.register=function(I,F,D,G,E){m(I,"username");m(F,"password");var H={Username:I,Password:F};a.extend(H,D);return this.create(H,G,E)};C.login=function(H,E,G,D){var F=this;return f(function(K,I){var J=new x(F.setup,{method:"POST",endpoint:"oauth/token",data:{username:H,password:E,grant_type:"password"},authHeaders:false,parse:x.parsers.single,success:function(){F._loginSuccess.apply(F,arguments);K.apply(null,arguments)},error:I});J.send()},G,D)};C.currentUser=function(F,D){var E=this;return f(function(H,G){l(E.setup,a.bind(E.getById,E,"me")).then(function(I){if(typeof I.user!=="undefined"){H({result:I.user})}else{H({result:null})}},function(I){G(I)})},F,D)};C.changePassword=function(J,G,F,E,I,D){var H=this;return f(function(N,L){var K="Users/changepassword";if(E){K+="?keepTokens=true"}var M=new x(H.setup,{method:"POST",endpoint:K,data:{Username:J,Password:G,NewPassword:F},authHeaders:false,parse:x.parsers.single,success:N,error:L});M.send()},I,D)};C.logout=function(F,D){var E=this;return f(function(I,G){var H=new x(E.setup,{method:"GET",endpoint:"oauth/logout",success:function(){E._logoutSuccess.apply(E,arguments);I.apply(null,arguments)},error:G});H.send()},F,D)};C._loginWithProvider=function(E,G,D){var H={Identity:E};var F=this;return f(function(K,I){var J=new x(F.setup,{method:"POST",endpoint:"Users",data:H,authHeaders:false,parse:x.parsers.single,success:function(){F._loginSuccess.apply(F,arguments);K.apply(null,arguments)},error:I});J.send()},G,D)};C._linkWithProvider=function(E,H,G,D){var F=this;return f(function(K,I){var J=new x(F.setup,{method:"POST",endpoint:"Users/"+H+"/link",data:E,parse:x.parsers.single,success:K,error:I});J.send()},G,D)};C._unlinkFromProvider=function(F,I,H,D){var E={Provider:F};var G=this;return f(function(L,J){var K=new x(G.setup,{method:"POST",endpoint:"Users/"+I+"/unlink",data:E,parse:x.parsers.single,success:L,error:J});K.send()},H,D)};C.loginWithFacebook=function(D,G,E){var F={Provider:"Facebook",Token:D};return C._loginWithProvider(F,G,E)};C.linkWithFacebook=function(H,D,G,E){var F={Provider:"Facebook",Token:D};return C._linkWithProvider(F,H,G,E)};C.unlinkFromFacebook=function(F,E,D){return C._unlinkFromProvider("Facebook",F,E,D)};C.loginWithADFS=function(D,G,E){var F={Provider:"ADFS",Token:D};return C._loginWithProvider(F,G,E)};C.linkWithADFS=function(H,D,G,E){var F={Provider:"ADFS",Token:D};return C._linkWithProvider(F,H,G,E)};C.unlinkFromADFS=function(F,E,D){return C._unlinkFromProvider("ADFS",F,E,D)};C.loginWithLiveID=function(D,G,E){var F={Provider:"LiveID",Token:D};return C._loginWithProvider(F,G,E)};C.linkWithLiveID=function(H,D,G,E){var F={Provider:"LiveID",Token:D};return C._linkWithProvider(F,H,G,E)};C.unlinkFromLiveID=function(F,E,D){return C._unlinkFromProvider("LiveID",F,E,D)};C.loginWithGoogle=function(D,G,E){var F={Provider:"Google",Token:D};return C._loginWithProvider(F,G,E)};C.linkWithGoogle=function(H,D,G,E){var F={Provider:"Google",Token:D};return C._linkWithProvider(F,H,G,E)};C.unlinkFromGoogle=function(F,E,D){return C._unlinkFromProvider("Google",F,E,D)};C.loginWithTwitter=function(G,H,F,D){var E={Provider:"Twitter",Token:G,TokenSecret:H};return C._loginWithProvider(E,F,D)};C.linkWithTwitter=function(I,G,H,F,D){var E={Provider:"Twitter",Token:G,TokenSecret:H};return C._linkWithProvider(E,I,F,D)};C.unlinkFromTwitter=function(F,E,D){return C._unlinkFromProvider("Twitter",F,E,D)}};var b=function(C){C.getUploadUrl=function(){return i.buildUrl(this.setup)+this.collectionName};C.getDownloadUrl=function(D){return i.buildUrl(this.setup)+this.collectionName+"/"+D+"/Download"};C._getUpdateUrl=function(D){return this.collectionName+"/"+D+"/Content"};C.getUpdateUrl=function(D){return i.buildUrl(this.setup)+this._getUpdateUrl(D)};C.updateContent=function(F,E,H,D){var G=this;return f(function(L,J){var I=G._getUpdateUrl(F);var K=G._createRequest({method:"PUT",endpoint:I,data:E,success:L,error:J});K.send()},H,D)}};var u={WindowsPhone:1,Windows8:2,Android:3,iOS:4,OSX:5,Blackberry:6,Nokia:7,Unknown:100};i.PushCallbacks={};var v=function(C){this._el=C;this._currentDevice;this.notifications=C.data("Push/Notifications");this.devices=C.data("Push/Devices")};v.prototype={currentDevice:function(C){if(!window.cordova){throw new Error("Error: currentDevice() can only be called from within a hybrid mobile app, after 'deviceready' event has been fired.")}if(!this._currentDevice){this._currentDevice=new g(this);this._currentDevice.emulatorMode=C}return this._currentDevice}};var w={iOS:{badge:true,sound:true,alert:true},android:{senderID:null},notificationCallbackAndroid:null,notificationCallbackIOS:null};var g=function(C){this._pushHandler=C;this._initSuccessCallback=null;this._initErrorCallback=null;this._globalFunctionSuffix=null;this.pushSettings=null;this.pushToken=null;this.isInitialized=false;this.isInitializing=false;this.emulatorMode=false};g.prototype={enableNotifications:function(D,E,C){this.pushSettings=D;return f(a.bind(this._initialize,this),E,C)},disableNotifications:function(E,C){var D=this;return this.unregister().then(function(){return f(function(H,F){if(D.emulatorMode){H()}else{var G=window.plugins.pushNotification;G.unregister(function(){D.isInitialized=false;H()},F)}},E,C)},C)},getRegistration:function(E,D){var C=this._getDeviceId();return this._pushHandler.devices.getById("HardwareId/"+C,E,D)},register:function(C,G,E){var F=this;var D={};if(C!==undefined){D.Parameters=C}return this._populateRegistrationObject(D).then(function(){return F._pushHandler.devices.create(D,G,E)},E)},unregister:function(E,D){var C=device.uuid;return this._pushHandler.devices.destroySingle({Id:"HardwareId/"+C},E,D)},updateRegistration:function(C,G,E){var F=this;var D={};if(C!==undefined){D.Parameters=C}return this._populateRegistrationObject(D).then(function(){D.Id="HardwareId/"+D.HardwareId;return F._pushHandler.devices.updateSingle(D,G,E)},E)},_initialize:function(K,E){var J=this;if(this.isInitializing){E(new Error("Push notifications are currently initializing."));return}if(!this.emulatorMode&&(!window.plugins||!window.plugins.pushNotification)){E(new Error("The push notifications plugin is not initialized."));return}if(!this.emulatorMode&&(!window.navigator||!window.navigator.globalization)){E(new Error("The globalization plugin is not initialized."));return}this._initSuccessCallback=K;this._initErrorCallback=E;if(this.isInitialized){this._deviceRegistrationSuccess(this.pushToken);return}if(this.emulatorMode){setTimeout(function(){J._deviceRegistrationSuccess("fake_push_token")},1000);return}this.isInitializing=true;var L=this._globalFunctionSuffix;if(!L){L=Date.now().toString();this._globalFunctionSuffix=L}var I=window.plugins.pushNotification;var H=this._getPlatformType(device.platform);if(H===u.iOS){var C="apnCallback_"+L;i.PushCallbacks[C]=a.bind(this._onNotificationAPN,this);var D=this.pushSettings.iOS;this._validateIOSSettings(D);D.ecb="Everlive.PushCallbacks."+C;I.register(a.bind(this._successfulRegistrationAPN,this),a.bind(this._failedRegistrationAPN,this),D)}else{if(H===u.Android){var F="gcmCallback_"+L;i.PushCallbacks[F]=a.bind(this._onNotificationGCM,this);var G=this.pushSettings.android;this._validateAndroidSettings(G);G.ecb="Everlive.PushCallbacks."+F;I.register(a.bind(this._successSentRegistrationGCM,this),a.bind(this._errorSentRegistrationGCM,this),G)}else{if(H===u.WindowsPhone){var M="wp8Callback_"+L;var P="wp8RegistrationSuccessCallback_"+L;var N="wp8RegistrationErrorCallback_"+L;i.PushCallbacks[M]=a.bind(this._onNotificationWP8,this);i.PushCallbacks[P]=a.bind(this._deviceRegistrationSuccessWP,this);i.PushCallbacks[N]=a.bind(this._deviceRegistrationFailed,this);var O=this.pushSettings.wp8;this._validateWP8Settings(O);O.ecb="Everlive.PushCallbacks."+M;O.uccb="Everlive.PushCallbacks."+P;O.errcb="Everlive.PushCallbacks."+N;I.register(a.bind(this._successSentRegistrationWP8,this),a.bind(this._errorSentRegistrationWP8,this),O)}else{throw new Error("The current platform is not supported: "+device.platform)}}}},_deviceRegistrationSuccessWP:function(C){this._deviceRegistrationSuccess(C.uri)},_validateAndroidSettings:function(C){if(!C.senderID){throw new Error("Sender ID (project number) is not set in the android settings.")}},_validateWP8Settings:function(C){if(!C.channelName){throw new Error("channelName is not set in the WP8 settings.")}},_validateIOSSettings:function(C){},_populateRegistrationObject:function(C,F,D){var E=this;return f(function(H,G){if(!E.pushToken){throw new Error("Push token is not available.")}E._getLocaleName(function(L){var I=E._getDeviceId();var J=device.name;var M=E._getPlatformType(device.platform);var P=q.determine().name();var O=E.pushToken;var K=L.value;var N=device.version;C.HardwareId=I;C.HardwareModel=J;C.PlatformType=M;C.PlatformVersion=N;C.TimeZone=P;C.PushToken=O;C.Locale=K;H()},G)},F,D)},_getLocaleName:function(D,C){if(this.emulatorMode){D({value:"en_US"})}else{navigator.globalization.getLocaleName(function(E){D(E)},C);navigator.globalization.getLocaleName(function(E){},C)}},_getDeviceId:function(){return device.uuid},_getPlatformType:function(C){var D=C.toLowerCase();switch(D){case"ios":case"iphone":case"ipad":return u.iOS;case"android":return u.Android;case"wince":return u.WindowsPhone;case"win32nt":return u.WindowsPhone;default:return u.Unknown}},_deviceRegistrationFailed:function(C){this.pushToken=null;this.isInitializing=false;this.isInitialized=false;if(this._initErrorCallback){this._initErrorCallback({error:C})}},_deviceRegistrationSuccess:function(C){this.pushToken=C;this.isInitializing=false;this.isInitialized=true;if(this._initSuccessCallback){this._initSuccessCallback({token:C})}},_successfulRegistrationAPN:function(C){this._deviceRegistrationSuccess(C)},_failedRegistrationAPN:function(C){this._deviceRegistrationFailed(C)},_successSentRegistrationGCM:function(C){},_successSentRegistrationWP8:function(C){},_errorSentRegistrationWP8:function(C){this._deviceRegistrationFailed(C)},_errorSentRegistrationGCM:function(C){this._deviceRegistrationFailed(C)},_onNotificationAPN:function(C){this._raiseNotificationEventIOS(C)},_onNotificationWP8:function(C){this._raiseNotificationEventWP8(C)},_onNotificationGCM:function t(C){switch(C.event){case"registered":if(C.regid.length>0){this._deviceRegistrationSuccess(C.regid)}break;case"message":this._raiseNotificationEventAndroid(C);break;case"error":if(!this.pushToken){this._deviceRegistrationFailed(C)}else{this._raiseNotificationEventAndroid(C)}break;default:this._raiseNotificationEventAndroid(C);break}},_raiseNotificationEventAndroid:function(C){if(this.pushSettings.notificationCallbackAndroid){this.pushSettings.notificationCallbackAndroid(C)}},_raiseNotificationEventIOS:function(C){if(this.pushSettings.notificationCallbackIOS){this.pushSettings.notificationCallbackIOS(C)}},_raiseNotificationEventWP8:function(C){if(this.pushSettings.notificationCallbackWP8){this.pushSettings.notificationCallbackWP8(C)}}};var o=function(){this.Users=this.data("Users");c(this.Users);this.Files=this.data("Files");b(this.Files);this.push=new v(this)};p.push({name:"default",func:o});return i}));
